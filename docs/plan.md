# 桌面修仙宠物 (Desktop Cultivator) - 终极开发策划文档 (融合版)

> **核心体验**: **挂机修仙 RPG** + **沉浸式视觉小说**。
> **玩法循环**: 挂机积累修为 -> 工作(键鼠操作)获取资源 -> 炼丹加速/突破 -> 换肤/更多特效。
> **表现形式**: 精美的静态立绘 + 氛围感粒子特效 + 生动的文字日志。

---

## 1. 核心循环 (The Loop)

游戏的数值驱动核心：
1.  **挂机 (Idle)** = **获得修为 (EXP)**。
    *   基础效率很低。
    *   通过吞服“精进丹药”来提升效率 (例如: 接下来1小时 +50%)。
2.  **操作 (Work)** = **获得材料 (Items)**。
    *   **键盘 (历练)**: 模拟外出探险，高概率掉落炼丹原材料。
    *   **鼠标 (悟道)**: 模拟研读经书，掉落配方、心境值、特殊辅材。
3.  **通过 坊市 (Market)** = **资源置换**。
    *   将 探险/历练 获得的 **大量低级废材** 换成 **灵石**。
    *   用灵石购买 **关键突破材料** 或 **稀有配方**。
4.  **炼丹 (Craft)** = **质变**。
    *   将廉价的材料转化为强大的增益 (加速挂机、突破瓶颈)。
5.  **突破 (Ascend)** = **解锁**。
    *   能够进入下一阶层，获取更高级的材料，解锁新的立绘皮肤。

---

## 2. 状态与视觉方案 (Visuals)

**理念**: 不做帧动画，做由代码驱动的“呼吸感”。

| 状态 | 触发条件 | 静态立绘 (Image) | 粒子特效 (Particle VFX) |
| :--- | :--- | :--- | :--- |
| **闭关 (Idle)** | 无操作 | **打坐图** (闭目, 周身微光) | **呼吸光点**: 少量光点缓慢浮动，模拟吐纳。 |
| **悟道 (Read)** | 仅鼠标 | **读书图** (悬浮, 手持卷宗) | **文字符文**: 偶尔飘出古文/代码符号。 |
| **历练 (Work)** | 仅键盘 | **御剑图** / **奔跑图** | **灵气汇聚**: 屏幕边缘生成大量光点，加速飞入体内 (随手速变快)。 |
| **斗法 (Combat)** | 高频操作 | **施法图** (结印, 发光) | **元素爆发**: 火焰/雷电粒子环绕；屏幕轻微震动。 |

---

## 3. 深度内容数据 (Tier Content)

### 3.1 炼气期 (Tier 1: Qi Refining)
*画风：山野隐士，草药与凡铁。*

**【材料 (15种)】**
*   **普通**: 洗髓草, 凝血花, 晨露水, 铁精, 枯木皮, 山泉水, 灵米, 凡铁矿, 狼毫, 废弃符纸。
*   **稀有**: 妖鼠尾, 青灵果, 萤火虫尾, 伴妖草, 鬼枯藤。

**【丹药 (10种) - 详细功效】**
1.  **聚气丹**: (洗髓草x3 + 山泉水) -> **[精进]** 瞬回 50 EXP。
2.  **凝血丹**: (凝血花x2 + 妖鼠尾) -> **[辅助]** 恢复 20% 护盾 (渡劫用)。
3.  **辟谷丹**: (灵米x5 + 晨露水) -> **[Buff]** 接下来 1小时 挂机收益 +10%。
4.  **神行散**: (萤火虫尾 + 青灵果) -> **[Buff]** 接下来 30分钟 材料掉落率 +20%。
5.  **大力丸**: (铁精 + 妖鼠尾) -> **[属性]** 永久体魄 +1 (微量提升渡劫抗性)。
6.  **清心散**: (晨露水x3) -> **[状态]** 降低 10点 心魔值。
7.  **饲灵丸**: (伴妖草 + 灵米) -> **[交互]** 宠物开心跳动，增加好感度(解锁语音)。
8.  **洗髓丹**: (枯木皮 + 洗髓草x5) -> **[属性]** 重置天赋点。
9.  **筑基丹(伪)**: (极其昂贵) -> **[突破]** 强行突破炼气圆满，成功率仅 10%，失败扣除修为。
10. **正版·筑基丹**: (需筑基主药 + 三种辅材) -> **[突破]** 突破至筑基期，成功率 60%。

### 3.2 筑基期 (Tier 2: Foundation)
*画风：初窥门径，元素与灵气。*

**【材料 (15种)】**
*   **普通**: 烈阳草, 寒晶矿, 赤铜精, 幻心草, 诱妖香, 妖兽肉, 无根水, 地乳。
*   **稀有**: 百年玄冰, 火精枣, 天雷竹, 二阶妖丹, 灵蛇蜕, 紫猴花, 筑基主药。

**【丹药 (12种)】**
1.  **培元丹**: (火精枣 + 地乳) -> **[精进]** 瞬回 500 点修为。
2.  **真元丹**: (二阶妖丹 + 玄铁) -> **[精进]** 瞬回 800 修为，但增加 5点 心魔。
3.  **黄龙丹**: (灵蛇蜕 + 烈阳草) -> **[精进]** 接下来 2小时 挂机收益 +30%。
4.  **定颜丹**: (紫猴花 + 无根水) -> **[特殊]** 解锁/切换 桌宠皮肤 (如：异色版)。
5.  **龟息丹**: (寒晶矿 + 百年玄冰) -> **[辅助]** 离线(关闭电脑)期间，修为获取不衰减(原为50%)。
6.  **狂暴丹**: (火精枣 x3) -> **[辅助]** 斗法攻击力翻倍，持续 10分钟。
7.  **五行散**: (随机五行材料) -> **[属性]** 随机增加 2点 根骨/悟性/体魄。
8.  **明目丹**: (幻心草 + 晨露水) -> **[特殊]** 可以看到材料的隐藏属性/掉率。
9.  **诱妖丹**: (诱妖香 + 妖兽肉) -> **[特殊]** 接下来 10分钟 遭遇战斗概率大幅提升 (刷材料用)。
10. **降尘丹**: (天雷竹 + 无根水) -> **[突破]** 增加结丹(突破金丹)概率 20%。
11. **凝金丹**: (金丹主药 + ...) -> **[突破]** 突破至金丹期。
12. **忘忧丹**: (幻心草 + 清心散) -> **[辅助]** 大幅消除心魔。

---

## 4. 关键系统 (Systems)

### 4.1 坊市系统 (Market System) - **新追加**

> "以物换物，各取所需。哪怕是废弃的符纸，也有人回收。"

*   **入口**: 右键菜单 -> 坊市。
*   **界面**: 独立的交易窗口。
*   **出售 (Sell)**:
    *   **一键出售**: 将背包中标记为“杂物”的材料全部卖出 (价格 = 基础价 * 0.5)。
    *   **废品回收**: 探险时常会捡到“废弃符纸”、“凡铁矿”等，是前期灵石的主要来源。
*   **购买 (Buy)**:
    *   **常驻商品**: 基础丹药 (贵)、基础工具 (如: 药锄，提升掉率)。
    *   **每日特惠 (Daily Deals)**:
        *   每天 0:00 刷新 6 个随机格子。
        *   可能刷出 **打折的洗髓草**，也可能刷出 **稀有的筑基主药** (一定要买！)。
    *   **黑市 (Black Market)**:
        *   周末开启，出售 **极品丹方** 或 **特殊皮肤**，售价极高。

### 4.2 探险/斗法 (Text Adventures)
不再做实时动作，而是 **文字事件 + 静态图切换**。
*   **触发**: 在“历练”状态下随机触发。
*   **UI**: 宠物头顶冒出一个半透明气泡 (类似漫画)。
*   **内容**:
    *   **图片**: 左侧显示小怪兽头像 (如: 简笔画/像素风的野猪)。
    *   **文字**: "前方丛林传来异响，一只【暴躁的野猪】冲了出来！"
    *   **结果**: "你随手打出一道剑气(敲击键盘)，野猪倒地。获得 [妖兽肉] x1。"

### 4.3 渡劫 (Tribulation)
*   **氛围**: 屏幕变暗 (覆盖半透明黑层), 只有中间的宠物是亮的。
*   **雷劈**: 屏幕瞬间 **反色/白屏** 闪烁，配合窗口 **震动** (OS级 Window Shake)。
*   **文字**: 巨大的红色警告字样 "天雷落下！护盾剩余 80%..."

---

## 5. 开发路线图 (Roadmap)

**Phase 1: 核心重构与视觉基建 (Refactor & Visuals) [已完成]**
1.  InputMonitor: 分离 Keyboard/Mouse。
2.  PetState: 完善状态机。
3.  ParticleWidget: 实现粒子特效。

**Phase 2: 数据与背包 (Data & Inventory) [进行中]**
1.  **ItemManager**: 加载 `items.json`，实现 30+ 种物品定义。 [已完成]
    *   *Need*: 定义物品的 price, type (material/consumable/junk).
2.  **InventoryUI**: 制作网格状背包界面。 [已完成]
3.  **DropSystem**: 实现根据不同状态掉落不同物品的逻辑。 [已完成]

**Phase 3: 坊市与经济 (Market & Economy) [已完成]**
1.  **MarketUI**: 商品列表与买卖逻辑。 [已完成]
2.  **RefreshLogic**: 每日随机刷新商品池。 [已完成]

**Phase 4: 炼丹与成长 (Alchemy & Growth) [已完成]**
1.  **AlchemyUI**: 炼丹界面。 [已完成]
2.  **Stats**: 实现 RPG 属性 (攻击/防御/挂机效率/心魔)。 [已完成]

**Phase 5: 完整闭环**
1.  **EventSystem**: 随机文字事件系统。
