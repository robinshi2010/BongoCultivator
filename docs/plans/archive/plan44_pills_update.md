# Plan 44: 丹药效果实装 (Implement Pill Effects)

## 🐛 问题描述 (Issue)
目前部分丹药（主要是功能类、灵液类、特殊类）在文档中显示为“无功效” (`-`)。用户希望所有丹药都能产生实际作用，例如增加属性、修为或短暂增益，避免“毫无作用”的情况。

## 🎯 目标 (Goals)
1.  **全面实装**: 为通过 `tools/list_pills.py` 查出的所有无效果丹药配置合理的 `effect_json`。
2.  **多样化效果**: 利用现有的属性系统（体魄 `stat_body`、心魔 `mind_heal`、好感/气运 `affection`、修为 `exp`/`exp_gain`）进行组合。
3.  **数据更新**: 编写脚本直接更新数据库中的物品定义。

## 🛠️ 实施方案 (Implementation Details)

### 1. 效果设计 (Effect Design)

| Tier | 名称 | 类型 | 原功效 | 新功效设计 (Proposal) | 逻辑解释 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| T0 | **避毒珠** | 功能 | - | `{"stat_body": 1}` | 强身健体，百毒不侵。 |
| T0 | **疾风散** | 增益 | - | `{"mind_heal": 5}` | 身轻如燕，心情舒畅 (-心魔)。 |
| T0 | **废丹** | 杂物 | - | `{"mind_heal": -5}` | 难吃，增加心魔 (惩罚)。 |
| T0 | **无根晨露** | 灵液 | - | `{"mind_heal": 5}` | 清灵之水，涤荡尘埃。 |
| T1 | **大地石乳** | 灵液 | - | `{"stat_body": 2}` | 地心精华，强化骨骼。 |
| T1 | **夜视散** | 功能 | - | `{"affection": 2}` | 发现更多细节 (+气运)。 |
| T2 | **定颜丹** | 外观 | - | `{"affection": 5}` | 容光焕发，魅力提升。 |
| T2 | **燃血丹** | 增益 | - | `{"exp_gain": 0.05, "stat_body": -2}` | 燃烧精血(扣体魄)，换取修为快速精进。 |
| T2 | **小气运丹** | 增益 | - | `{"affection": 10}` | 增加气运/福源。 |
| T3 | **身外化身丹** | 特殊 | - | `{"exp_gain": 0.10}` | 分身修炼，事半功倍。 |
| T3 | **缩地成寸符** | 功能 | - | `{"exp": 1000}` | 行万里路，阅历增加。 |
| T3 | **黄泉鬼水** | 灵液 | - | `{"mind_heal": -10, "stat_body": 3}` | 淬炼肉身但损伤神识。 |
| T4 | **破法丹** | 特殊 | - | `{"mind_heal": 30}` | 破除迷障，心魔大减。 |
| T4 | **一元重水** | 灵液 | - | `{"stat_body": 5}` | 极重之水，压榨潜力。 |
| T5 | **界游丹** | 增益 | - | `{"affection": 15}` | 游历万界，福缘深厚。 |
| T5 | **回天再造丸** | 恢复 | - | `{"stat_body": 20, "mind_heal": 20}` | 重塑肉身与精神，大补。 |
| T6 | **九转金丹** | 特殊 | - | `{"stat_body": 10, "mind_heal": 50, "exp_gain": 0.1}` | 全面提升，逆天改命。 |
| T6 | **造化神泉** | 灵液 | - | `{"stat_body": 10, "affection": 10}` | 夺天地造化。 |
| T7 | **长生丹** | 特殊 | - | `{"stat_body": 50}` | 寿元无尽（大幅加体魄）。 |
| T7 | **回溯丹** | 功能 | - | `{"mind_heal": 100}` | 世上终有后悔药，心结尽解。 |
| T8 | **天劫雷液** | 灵液 | - | `{"stat_body": 20, "exp_gain": 0.20}` | 毁灭后的新生。 |
| T8 | **避雷丹** | 增益 | - | `{"breakthrough_chance": 0.3}` | 增加 30% 渡劫成功率。 |
| T8 | **飞升丹** | 特殊 | - | `{"exp_gain": 0.50}` | 蕴含半仙之力，修为暴涨 50%。 |

### 2. 数据更新脚本
编写 `tools/update_pill_effects_v2.py`，遍历并更新上述物品的 `effect_json`。

### 3. 代码适配
- 检查 `src/inventory_window.py` 的 `use_item` 方法，确保它能正确处理 `stat_body` 为负数（扣属性）的情况（目前 `modify_stat` 支持 +/-）。
- 确保 `use_item` 能够通用地处理组合效果（目前是 `if/elif` 结构，需要改为顺序执行所有检测到的效果）。

## 📋 执行步骤 (Execution Steps)
- [ ] **创建更新脚本 `tools/update_pill_effects_v2.py`**: 定义 ID 到 Effect 的映射，批量更新数据库。
- [ ] **修改 `src/inventory_window.py`**: 重构 `use_item` 逻辑，支持单物品触发多种效果（移除互斥的 elif，改为累计处理）。
- [ ] **运行更新脚本**: 应用数据变更。
- [ ] **验证**:
    - 运行 `tools/list_pills.py` 查看生成的文档是否已更新。
    - 游戏中实际服用“燃血丹”，检查是否加了修为同时扣了体魄。

## 📝 验收标准 (Acceptance Criteria)
1.  `pills_list.md` 中不再出现无功效的丹药。
2.  服用混合效果丹药（如燃血丹）能正确触发所有属性变化。
3.  负面效果（如废丹）能正确减少属性或增加心魔。
